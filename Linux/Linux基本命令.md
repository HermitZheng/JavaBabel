# Linux基本命令

## 路径和目录操作

### 1 目录切换命令

- **`cd usr`：** 切换到该目录下usr目录
- **`cd ..（或cd../）`：** 切换到上一层目录
- **`cd /`：** 切换到系统根目录
- **`cd ~`：** 切换到用户主目录
- **`cd -`：** 切换到上一个操作所在目录



### 2 目录操作命令（增删改查）

- **`mkdir 目录名称`**：增加目录

- **`ls或者ll`**（ll是ls -l的别名，ll命令可以看到该目录下的所有目录和文件的详细信息）：查看目录信息

- **`find 目录 参数`：** 寻找目录

  示例：

  - 列出当前目录及子目录下所有文件和文件夹: `find .`

  - 在`/home`目录下查找以.txt结尾的文件名:`find /home -name "*.txt"`

  - 同上，但忽略大小写: `find /home -iname "*.txt"`

  - 当前目录及子目录下查找所有以.txt和.pdf结尾的文件：`find . \(-name "*.txt" -o -name "*.txt" \)` 

    或 `find . -name "*.txt" -o -name "*.txt"`

- **`mv 目录名称 新目录名称`：** 修改目录的名称

  注意：mv的语法不仅可以对目录进行重命名而且也可以对各种文件，压缩包等进行 重命名的操作。mv命令用来对文件或目录重新命名，或者将文件从一个目录移到另一个目录中。后面会介绍到mv命令的另一个用法。

- **`mv 目录名称 目录的新位置`：** 移动目录的位置---剪切

  注意：mv语法不仅可以对目录进行剪切操作，对文件和压缩包等都可执行剪切操作。另外mv与cp的结果不同，mv好像文件“搬家”，文件个数并未增加。而cp对文件进行复制，文件个数增加了。

- **`cp -r 目录名称 目录拷贝的目标位置`：** 拷贝目录，**-r代表递归拷贝，即对多层的文件夹进行拷贝**

  注意：cp命令不仅可以拷贝目录还可以拷贝文件，压缩包等，拷贝文件和压缩包时不 用写-r递归

- **`rm [-rf] 目录`:** 删除目录

  注意：rm不仅可以删除目录，也可以删除其他文件或压缩包，为了增强大家的记忆， 无论删除任何目录或文件，都直接使用`rm -rf` 目录/文件/压缩包



## 文件操作

### 1 文件操作命令（增删改查）

- **`touch 文件名称`:** 文件的创建

- **`cat/more/less/tail 文件名称`** 文件的查看（查）

  - **`cat`：** 查看显示文件内容（-n加上行号）
  - **`more`：** 可以显示百分比，回车可以向下一行， 空格可以向下一页，q可以退出查看
  - **`less`：** 可以使用键盘上的PgUp和PgDn向上 和向下翻页，q结束查看
  - **`tail -10` ：** 查看文件的后10行，Ctrl+C结束
  - **`head -10`**
  - **`nl`：**对输出的文件内容自动的加上行号，可以将行号做比较多的显示设计，包括位数与是否自动补齐 0 等等的功能。

  注意：**命令 tail -f 文件 可以对某个文件进行动态监控**，例如tomcat的日志文件，会随着程序的运行，日志会变化；

  - 可以使用**`tail -f catalina-2016-11-11.log `**监控文件的变化

- **`vim 文件`：** 修改文件的内容

  vim编辑器是Linux中的强大组件，是vi编辑器的加强版，vim编辑器的命令和快捷方式有很多，但此处不一一阐述，大家也无需研究的很透彻，使用vim编辑修改文件的方式基本会使用就可以了。

  **在实际开发中，使用vim编辑器主要作用就是修改配置文件，下面是一般步骤：**

  vim 文件------>进入文件----->命令模式------>按 i 进入编辑模式----->编辑文件 ------->按Esc进入底行模式----->输入：wq/q! （输入wq代表写入内容并退出，即保存；输入q!代表强制退出不保存。）

- **`rm -rf 文件`：** 删除文件

  同目录删除：熟记 `rm -rf` 文件 即可

### 2 压缩文件的操作命令

**1）打包并压缩文件：**

Linux中的**打包**文件一般是以.tar结尾的，**压缩**的命令一般是以.gz结尾的。

而一般情况下打包和压缩是一起进行的，打包并压缩后的文件的后缀名一般.tar.gz。 命令：**`tar -zcvf 打包压缩后的文件名 要打包压缩的文件`** 其中：

-z：调用gzip压缩命令进行压缩

-c：打包文件

-v：显示运行过程

-f：指定文件名

比如：假如test目录下有三个文件分别是：aaa.txt bbb.txt ccc.txt，如果我们要打包test目录并指定压缩后的压缩包名称为test.tar.gz可以使用命令：

**`tar -zcvf test.tar.gz aaa.txt bbb.txt ccc.txt `**

**或：`tar -zcvf test.tar.gz /test/`**

**2）解压压缩包：**

命令：**`tar [-xvf] 压缩文件 `**

其中：

-x：代表解压

-v：显示运行过程（同上）

-f：指定文件名（同上）

示例：

1 将/test下的test.tar.gz解压到当前目录下可以使用命令：**`tar -xvf test.tar.gz`**

2 将/test下的test.tar.gz解压到根目录/usr下:**`tar -xvf test.tar.gz -C /usr`**（- C代表指定解压的位置）



## 权限操作

### 权限信息

操作系统中每个文件都拥有特定的权限、所属用户和所属组。权限是操作系统用来限制资源访问的机制，在Linux中权限一般分为**读**(readable)、**写**(writable)和**执行**(excutable)，分为三组。分别对应文件的属**主**(owner)，属**组**(group)和**其他用户**(other)，通过这样的机制来限制哪些用户、哪些组可以对特定的文件进行什么样的操作。通过 **`ls -l`** 命令我们可以 查看某个目录下的文件或目录的权限：

![image-20200710193800574](C:\Users\Hanabi\AppData\Roaming\Typora\typora-user-images\image-20200710193800574.png)

其中第一列显示的就是文件的权限信息：

![image-20200710193836026](C:\Users\Hanabi\AppData\Roaming\Typora\typora-user-images\image-20200710193836026.png)

**文件的类型：**

- d： 代表**目录**
- -： 代表**文件**
- l： 代表**软链接**（可以认为是window中的快捷方式）

**Linux中权限分为以下几种：**

- r：代表权限是**可读**，r也可以用数字4表示
- w：代表权限是**可写**，w也可以用数字2表示
- x：代表权限是**可执行**，x也可以用数字1表示

**文件和目录权限的区别：**

对文件和目录而言，读写执行表示不同的意义。

对于**文件**：

| 权限名称 | 可执行操作                |
| -------- | ------------------------- |
| r        | 可以使用cat查看文件的内容 |
| w        | 可以修改文件的内容        |
| x        | 可以将其运行为二进制文件  |

对于**目录**：

| 权限名称 | 可执行操作               |
| -------- | ------------------------ |
| r        | 可以查看目录下列表       |
| w        | 可以创建和删除目录下文件 |
| x        | 可以使用cd进入目录       |

**需要注意的是超级用户可以无视普通用户的权限，即使文件目录权限是000，依旧可以访问。** **在linux中的每个用户必须属于一个组，不能独立于组外。在linux中每个文件有所有者、所在组、其它组的概念。**

- **所有者**

  一般为文件的创建者，谁创建了该文件，就天然的成为该文件的所有者，用**`ls ‐ahl`**命令可以看到文件的所有者 也可以使用**`chown`** 用户名 文件名来修改文件的所有者 。

- **文件所在组**

  当某个用户创建了一个文件后，这个文件的所在组就是该用户所在的组 用**`ls ‐ahl`**命令可以看到文件的所有组 也可以使用**`chgrp `**组名 文件名来修改文件所在的组。

- **其它组**

  除开文件的所有者和所在组的用户外，系统的其它用户都是文件的其它组

### 修改权限

**修改文件/目录的权限的命令：`chmod`**

示例：修改/test下的aaa.txt的权限为属主有全部权限，属主所在的组有读写权限， 其他用户只有读的权限

**`chmod u=rwx,g=rw,o=r perm.txt`**

**`chmod -R u=rwx,g=rwx,o=rwx ./test`** // 递归给test目录下的所有文件授权

![image-20200710194940154](C:\Users\Hanabi\AppData\Roaming\Typora\typora-user-images\image-20200710194940154.png)

上述示例还可以使用数字表示：**`chmod 764 perm.txt`**

**补充一个比较常用的东西:**

假如我们装了一个zookeeper，我们每次开机到要求其自动启动该怎么办？

1. 新建一个脚本zookeeper
2. 为新建的脚本zookeeper添加可执行权限，命令是:`chmod +x zookeeper`
3. 把zookeeper这个脚本添加到开机启动项里面，命令是：` chkconfig --add zookeeper`
4. 如果想看看是否添加成功，命令是：`chkconfig --list`



## 用户管理



## 性能监控和优化

**`top `：**显示当前系统正在执行的进程的相关信息，包括进程ID、内存占用率、CPU占用率等。

**`free`：**显示系统使用和空闲的内存情况，包括物理内存、交互区内存(swap)和内核缓冲区内存。

```
free	# 显示内存情况。
free -g 	# 以GB为单位
free -m 	# 以MB为单位
```

**`vmstat`：**用来显示虚拟内存的信息。

```
vmstat -a 5 5 	# 5秒时间内进行5次采样
```

**`lostat `：**通过iostat方便查看CPU、网卡、tty设备、磁盘、CD-ROM 等等设备的活动情况, 负载信息。

```
iostat 2 3 	#每隔 2秒刷新显示，且显示3次
```

**`lsof `：**用于查看你进程打开的文件，打开文件的进程，进程打开的端口(TCP、UDP)。

```
lsof /bin/bash		# 查看谁正在使用bash文件，也就是说查找某个文件相关的进程。
```



## 网络命令

**`ipconfig `：**查看和配置网络设备。

```
ifconfig eth0 up		# 启动关闭指定网卡
ifconfig eth0 down
```

```
# 用ifconfig修改MAC地址
ifconfig eth0 hw ether 00:AA:BB:CC:DD:EE
```

**`route `：**用于操作基于内核ip路由表，它的主要作用是创建一个静态路由让指定一个主机或者一个网络通过一个网络接口，如eth0。

```
route 		# 显示当前路由
route -n
```

```
# 添加网关/设置网关
route add -net 224.0.0.0 netmask 240.0.0.0 dev eth0
```

**`ping`：**确定网络和各外部主机的状态；跟踪和隔离硬件和软件问题；测试、评估和管理网络。

```
ping -b 192.168.120.1		# ping 网关
```

**`traceroute `：**让你追踪网络数据包的**路由途径**，预设数据包大小是40Bytes，用户可另行设置。

```
traceroute www.baidu.com		# 最常用的用法
traceroute -m 10 www.baidu.com		# 跳数设置
```

**`netstat`：**用于显示与IP、TCP、UDP和ICMP协议相关的统计数据，一般用于**检验本机各端口的网络连接情况**。

```
netstat -a	# 列出所有端口
```

**`telnet`：**执行telnet指令开启终端机阶段作业，并登入远端主机。

```
telnet 192.168.120.206
```



## 其他常用命令

- **`pwd`：** 显示当前所在位置

- **`sudo + 其他命令`**：以系统管理者的身份执行指令，也就是说，经由 sudo 所执行的指令就好像是 root 亲自执行。

- **`grep 要搜索的字符串 要搜索的文件 --color`：** 搜索命令，--color代表高亮显示

- **`ps -ef`/`ps -aux`：** 这两个命令都是查看当前系统正在运行进程，两者的区别是展示格式不同。

  - 如果想要查看特定的进程可以使用这样的格式：**`ps aux|grep redis`** 或 **`ps -ef|grep redis`**（查看包括redis字符串的进程）
  - 也可使用**`pgrep redis -a`**。

  注意：如果直接用**`ps`**（（Process Status））命令，会显示所有进程的状态，通常结合grep命令查看某进程的状态。

- **`kill -9 进程的pid`：** 杀死进程（-9 表示强制终止。）先用ps查找进程，然后用kill杀掉

- **net-tools 和 iproute2 ：** **`net-tools`**起源于BSD的TCP/IP工具箱，后来成为老版本Linux内核中配置网络功能的工具。但自2001年起，Linux社区已经对其停止维护。同时，一些Linux发行版比如Arch Linux和CentOS/RHEL 7则已经完全抛弃了net-tools，只支持**`iproute2`**。linux ip命令类似于ifconfig，但功能更强大，旨在替代它。更多详情请阅读[如何在Linux中使用IP命令和示例](https://linoxide.com/linux-command/use-ip-command-linux)

- **`shutdown`：** `shutdown -h now`： 指定现在立即关机；`shutdown +5 "System will shutdown after 5 minutes"`：指定5分钟后关机，同时送出警告信息给登入用户。

- **`reboot`：** **`reboot`：** 重开机。**`reboot -w`：** 做个重开机的模拟（只有纪录并不会真的重开机）。



## 性能分析

针对应用程序，我们通常关注的是内核CPU调度器功能和性能。

线程的状态分析主要是分析线程的时间用在什么地方，而线程状态的分类一般分为：

a. on-CPU：**执行中**，执行中的时间通常又分为**用户态**时间user和**系统态**时间sys。

b. off-CPU：**等待**下一轮上CPU，或者等待I/O、锁、换页等等，其状态可以细分为**可执行**、**匿名换页**、**睡眠**、**锁**、**空闲**等状态。

#### **分析工具**

| 工具       | 描述                           |
| ---------- | ------------------------------ |
| uptime / w | 查看服务器运行时间、平均负载   |
| top        | 监控每个进程的CPU用量分解      |
| vmstat     | 系统的CPU平均负载情况          |
| mpstat     | 查看多核CPU信息                |
| sar -u     | 查看CPU过去或未来时点CPU利用率 |
| pidstat    | 查看每个进程的用量分解         |

#### uptime

**`uptime`** 命令可以用来查看服务器已经运行了多久，当前登录的用户有多少，以及服务器在过去的1分钟、5分钟、15分钟的系统平均负载值

![image-20200710235501460](C:\Users\Hanabi\AppData\Roaming\Typora\typora-user-images\image-20200710235501460.png)

第一项是当前时间，up 表示系统正在运行，4:05是系统启动的总时间，最后是系统的负载load信息

**`w`** 同上，增加了具体登陆了哪些用户及登陆时间。

![image-20200710235525847](C:\Users\Hanabi\AppData\Roaming\Typora\typora-user-images\image-20200710235525847.png)

#### top

常用来监控[Linux](http://lib.csdn.net/base/linux)的系统状况，比如cpu、内存的使用，显示系统上正在运行的进程。

![image-20200710235652164](C:\Users\Hanabi\AppData\Roaming\Typora\typora-user-images\image-20200710235652164.png)

| 进程的属性 | 属性含义                                                     |
| ---------- | ------------------------------------------------------------ |
| PID        | 进程ID，进程的唯一标识符                                     |
| USER       | 进程所有者的实际用户名。                                     |
| PR         | 进程的调度优先级。这个字段的一些值是’rt’。这意味这这些进程运行在实时态。 |
| NI         | 进程的nice值（优先级）。越小的值意味着越高的优先级。         |
| VIRT       | 进程使用的虚拟内存。                                         |
| RES        | 驻留内存大小。驻留内存是任务使用的非交换物理内存大小。       |
| SHR        | SHR是进程使用的共享内存。                                    |
| S          | 这个是进程的状态。它有以下不同的值: D–不可中断的睡眠态、R–运行态、S–睡眠态、T–被跟踪或已停止、Z – 僵尸态 |
| %CPU       | 自从上一次更新时到现在任务所使用的CPU时间百分比。            |
| %MEM       | 进程使用的可用物理内存百分比。                               |
| TIME+      | 任务启动后到现在所使用的全部CPU时间，精确到百分之一秒。      |
| COMMAND    | 运行进程所使用的命令。                                       |

**命令行选项**

> top //每隔3秒显式所有进程的资源占用情况
>
> top -u oracle -c //按照用户显示进程、并显示完整命令
>
> top -d 2 //每隔2秒显式所有进程的资源占用情况
>
> top -c //每隔3秒显式进程的资源占用情况，并显示进程的命令行参数(默认只有进程名)
>
> top -p 12345 -p 6789//每隔3秒显示pid是12345和pid是6789的两个进程的资源占用情况
>
> top -d 2 -c -p 123456 //每隔2秒显示pid是12345的进程的资源使用情况，并显式该进程启动的命令行参数
>
> top -n 设置显示多少次后就退出

#### vmstat

 **`vmstat`**命令是最常见的Linux/Unix监控工具，可以展现给定时间间隔的服务器的状态值,包括服务器的CPU使用率，内存使用，虚拟内存交换情况,IO读写情况。

 一般vmstat工具的使用是通过两个数字参数来完成的，第一个参数是采样的时间间隔数，单位是秒，第二个参数是采样的次数，如:

![image-20200710235737359](C:\Users\Hanabi\AppData\Roaming\Typora\typora-user-images\image-20200710235737359.png)

**Procs（进程）**

| r:   | 运行队列中进程数量，这个值也可以判断是否需要增加CPU。（长期大于1） |
| ---- | ------------------------------------------------------------ |
| b    | 等待IO的进程数量。                                           |

**Memory（内存）**

| swpd  | 使用虚拟内存大小，如果swpd的值不为0，但是SI，SO的值长期为0，这种情况不会影响系统性能。 |
| ----- | ------------------------------------------------------------ |
| free  | 空闲物理内存大小。                                           |
| buff  | 用作缓冲的内存大小。                                         |
| cache | 用作缓存的内存大小，如果cache的值大的时候，说明cache处的文件数多，如果频繁访问到的文件都能被cache处，那么磁盘的读IO bi会非常小。 |

**Swap**

| si   | 每秒从交换区写到内存的大小，由磁盘调入内存。 |
| ---- | -------------------------------------------- |
| so   | 每秒写入交换区的内存大小，由内存调入磁盘。   |

注意：内存够用的时候，这2个值都是0，如果这2个值长期大于0时，系统性能会受到影响，磁盘IO和CPU资源都会被消耗。有些朋友看到空闲内存（free）很少的或接近于0时，就认为内存不够用了，不能光看这一点，还要结合si和so，如果free很少，但是si和so也很少（大多时候是0），那么不用担心，系统性能这时不会受到影响的。因为linux总是先把内存用光.

**IO**

| bi   | 每秒读取的块数 |
| ---- | -------------- |
| bo   | 每秒写入的块数 |

注意：随机磁盘读写的时候，这2个值越大（如超出1024k)，能看到CPU在IO等待的值也会越大。

**system（系统）**

| in   | 每秒中断数，包括时钟中断。 |
| ---- | -------------------------- |
| cs   | 每秒上下文切换数。         |

注意：上面2个值越大，会看到由内核消耗的CPU时间会越大。

**CPU（以百分比表示）**

| us   | 用户进程执行时间百分比(user time) us的值比较高时，说明用户进程消耗的CPU时间多，但是如果长期超50%的使用，那么我们就该考虑优化程序算法或者进行加速。 |
| ---- | ------------------------------------------------------------ |
| sy:  | 内核系统进程执行时间百分比(system time) sy的值高时，说明系统内核消耗的CPU资源多，这并不是良性表现，我们应该检查原因。 |
| wa   | IO等待时间百分比 wa的值高时，说明IO等待比较严重，这可能由于磁盘大量作随机访问造成，也有可能磁盘出现瓶颈（块操作）。 |
| id   | 空闲时间百分比                                               |

#### mpstat

 mpstat是一个实时监控工具，主要报告与CPU相关统计信息,在多核心cpu系统中，不仅可以查看cpu平均信息，还可以查看指定cpu信息。

```
mpstat -P ALL 	//查看全部CPU的负载情况。
mpstat 2 5 		//可指定间隔时间和次数。
```

![image-20200710235824692](C:\Users\Hanabi\AppData\Roaming\Typora\typora-user-images\image-20200710235824692.png)

#### sar

系统活动情况报告，可以从多方面对系统的活动进行报告，包括：文件的读写情况、系统调用的使用情况、磁盘I/O、CPU效率、内存使用状况、进程活动及IPC有关的活动等

![image-20200710235849031](C:\Users\Hanabi\AppData\Roaming\Typora\typora-user-images\image-20200710235849031.png)

#### pidstat

用于监控全部或指定进程的cpu、内存、线程、设备IO等系统资源的占用情况。

pidstat 和 pidstat -u -p ALL 是等效的。 pidstat 默认显示了所有进程的cpu使用率。

![image-20200710235918094](C:\Users\Hanabi\AppData\Roaming\Typora\typora-user-images\image-20200710235918094.png)